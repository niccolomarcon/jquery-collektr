/*
 *  jquery-collektr - v1.0.0
 *  A jquery plugin that can embed collektr in a web page.
 *  http://niccolomarcon.github.io/jquery-collektr/
 *
 *  Made by Niccol√≤ Marcon
 *  Under MIT License
 */
(function(){!function(a,b,c){var d,e,f;return f="collektr",e=function(){function c(b,c){this.element=b,this.settings=a.extend({},d,c),this._defaults=d,this._name=f,this.init()}var d;return d={handlebarURL:"http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/3.0.3/handlebars.min.js",templateURL:null,masonryURL:"http://cdnjs.cloudflare.com/ajax/libs/masonry/3.3.0/masonry.pkgd.min.js",imgLoadedURL:"http://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.1.8/imagesloaded.pkgd.min.js",fancyURL:"http://cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.js",fancyCssURL:"http://cdn.jsdelivr.net/fancybox/2.1.5/jquery.fancybox.min.css",customHelpers:null,range:null,offset:20,fullScreen:!0,columnNumber:5,containerID:"#collektr",container:"collektr",noScroll:!1,builtInTemplate:'{{#each this}}\n  <div class="{{label}} new collektr-entry" id="{{id}}" data-external-id="{{external_id}}">\n    <div class="panel panel-default">\n      <div class="panel-heading">\n        <img src="{{profile_image_url}}" class="img-profile" style="max-height: 48px; max-width: 48px;">\n        <span class="small">\n          <a href="{{profile_url}}" target="_blank">{{from}}</a>\n        </span>\n      </div>\n      <div class="media-wrapper" align="center">\n        {{#switchMedia this}}{{/switchMedia}}\n      </div>\n      <div class="panel-body">\n        {{#ifContent content}}\n          <p style="word-wrap: break-word;">{{#parseLinks content}}{{/parseLinks}}</p>\n        {{/ifContent}}\n      </div>\n      <div class="panel-footer">\n        <a href="{{original_content_url}}" target="_blank">\n          <i class="fa img-provider fa-{{provider_name}}"></i>\n        </a>\n        <span class="small">{{#parseDate created_at}}{{/parseDate}}</span>\n        <div class="btn-group pull-right dropdown">\n          <button type="button" class="btn btn-xs dropdown-toggle" id="dropdownMenu{{id}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">\n            <i class="fa fa-share"></i>\n          </button>\n          <ul class="dropdown-menu" aria-labelledby="dropdownMenu{{id}}">\n            <li><div class="fb-like" data-href="{{original_content_url}}" data-width="200" data-layout="button_count" data-action="like" data-show-faces="false" data-share="true"></div></li>\n            <li><div class="g-plusone" data-annotation="inline" data-width="300" data-href="{{original_content_url}}"></div></li>\n            <li><a href="https://twitter.com/share" class="twitter-share-button" data-url="{{original_content_url}}" data-text="{{content}}">Tweet</a></li>\n            {{#ifImg content_type}}<li><div class="share" pin-it="{{content}}" pin-it-url="{{original_content_url}}" pin-it-image="{{media_url}}"></div></li>{{/ifImg}}\n          </ul>\n        </div>\n        <div class="clearfix"></div>\n      </div>\n    </div>\n  </div>\n{{/each}}',urlCard:function(a,b){return"http://api.collektr.com/boards/"+a+"/cards.json?user_token="+b},callback:function(){return!1}},c.prototype.init=function(){var a;return null==this.settings.token&&console.log("token is missing"),null==this.settings.selector&&console.log("selector is missing"),1<=(a=this.settings.columnNumber)&&10>=a||console.log("columnNumber should be between 1 and 10"),this.wrap(),this.masonrySetup(),this.handlebarsSetup(),this.styleSetup(),this.fancySetup(),null==this.settings.range&&(this.settings.range=[0,29]),this.fetch()},c.prototype.fetch=function(){return a.ajax({url:this.settings.urlCard(this.settings.selector,this.settings.token),data:"data",success:function(a){return function(b){return a.render(b)}}(this),headers:{"Range-Unit":"items",Range:""+this.settings.range[0]+"-"+this.settings.range[1]}})},c.prototype.render=function(b){var c;return c=function(c){return function(d){var e;return e=Handlebars.compile(d),a(c.element).find(c.settings.containerID).append(e(b)),a(".new").css("display","none"),c.masonry(),c.upgradeRange(),c.settings.noScroll||c.scroll(),c.fireCallback()}}(this),null!=this.settings.templateURL?a.get(this.settings.templateURL,function(){return function(a){return c(a)}}(this)):c(this.settings.builtInTemplate)},c.prototype.upgradeRange=function(){return this.settings.range[0]=this.settings.range[1]+1,this.settings.range[1]+=this.settings.offset},c.prototype.scroll=function(){var c;return c=this.settings.fullScreen?b:a(this.element),a(c).endlessScroll({fireDelay:100,callback:function(a){return function(){return a.fetch()}}(this)})},c.prototype.masonry=function(){return a(this.element).find(this.settings.containerID).masonry("appended",a(".new"),!0),a.get(this.settings.imgLoadedURL,function(b){return function(){return imagesLoaded(a(b.element).find(b.settings.containerID),function(){return a(b.element).find(b.settings.containerID).masonry(),a(".new").css("display","block")})}}(this)),a(".new").removeClass("new")},c.prototype.wrap=function(){return a(this.element).append("<div id='"+this.settings.container+"' />")},c.prototype.masonrySetup=function(){var b;return b=function(b){return function(){return a(b.element).find(b.settings.containerID).masonry({itemSelector:".collektr-entry",percentPosition:!0})}}(this),"undefined"!=typeof masonry&&null!==masonry?b():a.get(this.settings.masonryURL,function(){return function(){return b()}}(this))},c.prototype.handlebarsSetup=function(){var b;return b=function(a){return function(){return Handlebars.registerHelper("parseLinks",function(a){var b;return b=/(([a-z]+:\/\/)?(([a-z0-9\-]+\.)+([a-z]{2}|aero|arpa|biz|com|coop|edu|gov|info|int|jobs|mil|museum|name|nato|net|org|pro|travel|local|internal))(:[0-9]{1,5})?(\/[a-z0-9_\-\.~]+)*(\/([a-z0-9_\-\.]*)(\?[a-z0-9+_\-\.%=&amp;]*)?)?(#[a-zA-Z0-9!$&'()*+.=-_~:@/?]*)?)(\s+|$)/gi,a.replace(b,function(a){var b;return b=/[a-z]+:\/\//.test(a)?a:"http://"+a,a=a.replace(/^https?:\/\//,""),"<a href='"+b+"' target='_blank'>"+a+"</a>"})}),Handlebars.registerHelper("parseDate",function(a){var b,c;return c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Oct","Nov","Dec"],b=new Date(a),""+c[b.getMonth()]+" "+b.getDate()+", "+b.getFullYear()+" "+b.toLocaleTimeString("en-US")}),Handlebars.registerHelper("ifContent",function(a,b){return null!=a&&a.length>0?b.fn(this):void 0}),Handlebars.registerHelper("ifImg",function(a,b){return"image"===a?b.fn(this):void 0}),Handlebars.registerHelper("switchMedia",function(a){var b;return"text"===a.content_type?"<div></div>":"image"===a.content_type?'<a href="'+a.media_url+'" class="fancybox" target="_blank"><img src="'+a.media_url+'" class="img-responsive" style="width: 100%"></a>':"facebook"===a.provider_name||"instagram"===a.provider_name?(b="facebook"===a.provider_name?a.media_tag.match(/src="(.+)"/)[1]:a.media_url,"<a href='"+b+"' class='fancybox' data-fancybox-type='iframe'><img src='"+a.thumbnail_image_url+"' class='img-responsive' style='width: 100%'></a>"):'<div class="embed-responsive embed-responsive-4by3">'+a.media_tag+"</div>"}),null!=a.settings.customHelpers?a.settings.customHelpers():void 0}}(this),"undefined"!=typeof Handlebars&&null!==Handlebars?b():a.get(this.settings.handlebarURL,function(){return function(){return b()}}(this))},c.prototype.styleSetup=function(){return a("head").append(function(a){return function(){var b,c;return c=100/a.settings.columnNumber-2,b=""!==a.element.id?"#"+a.element.id:"."+a.element.className,"<style>"+b+" .collektr-entry { width: "+c+"%; margin: 0% 1% 0% 1%; }</style><link rel='stylesheet' href='"+a.settings.fancyCssURL+"' type='text/css' 'media=screen' />"}}(this))},c.prototype.fancySetup=function(){var b;return b=function(){return function(){return a(".fancybox").fancybox()}}(this),"undefined"!=typeof fancybox&&null!==fancybox?b():a.get(this.settings.fancyURL,function(){return function(){return b()}}(this))},c.prototype.fireCallback=function(){return this.settings.callback()},c}(),d=function(){function d(b,c){this.options=a.extend({},e,c),this.pagesStack=[0],this.scrollDirection="next",this.firing=!0,this.fired=!1,this.fireSequence=0,this.pageSequence=0,this.nextSequence=1,this.prevSequence=-1,this.lastScrollTop=0,this.insertLocation=this.options.insertAfter,this.didScroll=!1,this.isScrollable=!0,this.target=b,this.targetId="",this.content="",this.lastContent="dummy",this.innerWrap=a(".endless_scroll_inner_wrap",this.target),this.handleDeprecatedOptions(),this.setInsertPositionsWhenNecessary(),a(b).scroll(function(a){return function(){return a.detectTarget(b),a.detectScrollDirection()}}(this))}var e;return e={pagesToKeep:null,inflowPixels:0,fireOnce:!1,fireDelay:150,loader:"",content:"",insertBefore:null,insertAfter:null,intervalFrequency:250,ceaseFireOnEmpty:!0,resetCounter:function(){return!1},callback:function(){return!0},ceaseFire:function(){return!1}},d.prototype.run=function(){return setInterval(function(a){return function(){return a.shouldTryFiring()&&!a.ceaseFireWhenNecessary()&&a.shouldBeFiring()?(a.resetFireSequenceWhenNecessary(),a.acknowledgeFiring(),a.hasContent()&&(a.fireCallback(),a.cleanUpPagesWhenNecessary(),a.delayFiringWhenNecessary()),a.lastContent=a.content):void 0}}(this),this.options.intervalFrequency)},d.prototype.handleDeprecatedOptions=function(){return this.options.data&&(this.options.content=this.options.data),this.options.bottomPixels?this.options.inflowPixels=this.options.bottomPixels:void 0},d.prototype.setInsertPositionsWhenNecessary=function(){var a;return a=""+this.target.selector+" div.endless_scroll_inner_wrap",null===e.insertBefore&&(this.options.insertBefore=""+a+" div:first"),null===e.insertAfter?this.options.insertAfter=""+a+" div:last":void 0},d.prototype.detectTarget=function(b){return this.target=b,this.targetId=a(this.target).attr("id")},d.prototype.detectScrollDirection=function(){var b;return this.didScroll=!0,b=a(this.target).scrollTop(),b>this.lastScrollTop&&(this.scrollDirection="next"),this.lastScrollTop=b},d.prototype.shouldTryFiring=function(){var a;return a=this.didScroll&&this.firing===!0,a&&(this.didScroll=!1),a},d.prototype.ceaseFireWhenNecessary=function(){return this.options.ceaseFireOnEmpty===!0&&""===this.lastContent||this.options.ceaseFire.apply(this.target,[this.fireSequence,this.pageSequence,this.scrollDirection])?(this.firing=!1,!0):!1},d.prototype.wrapContainer=function(b){return this.innerWrap=a(b).find("#collektr")},d.prototype.scrollableAreaMargin=function(b,c){var d;switch(this.scrollDirection){case"next":d=b.height()-a(c).height()<=a(c).scrollTop()+this.options.inflowPixels,d&&c.scrollTop(b.height()-a(c).height()-this.options.inflowPixels);break;case"prev":d=a(c).scrollTop()<=this.options.inflowPixels,d&&c.scrollTop(this.options.inflowPixels)}return d},d.prototype.calculateScrollableCanvas=function(){return this.target[0]===c||this.target[0]===b?this.isScrollable=this.scrollableAreaMargin(a(c),a(b)):(this.wrapContainer(this.target),this.isScrollable=this.innerWrap.length>0&&this.scrollableAreaMargin(this.innerWrap,this.target))},d.prototype.shouldBeFiring=function(){return this.calculateScrollableCanvas(),this.isScrollable&&(this.options.fireOnce===!1||this.options.fireOnce===!0&&this.fired!==!0)},d.prototype.resetFireSequenceWhenNecessary=function(){return this.options.resetCounter.apply(this.target)===!0?this.fireSequence=0:void 0},d.prototype.acknowledgeFiring=function(){switch(this.fired=!0,this.fireSequence++,this.scrollDirection){case"next":return this.pageSequence=this.nextSequence++;case"prev":return this.pageSequence=this.prevSequence--}},d.prototype.insertContent=function(b){switch(this.scrollDirection){case"next":return a(this.options.insertAfter).after(b);case"prev":return a(this.options.insertBefore).before(b)}},d.prototype.insertLoader=function(){return this.insertContent('<div class="endless_scroll_loader_'+this.targetId+' endless_scroll_loader">'+this.options.loader+"</div>")},d.prototype.removeLoader=function(){return a(".endless_scroll_loader_"+this.targetId).fadeOut(function(){return a(this).remove()})},d.prototype.hasContent=function(){return this.content="function"==typeof this.options.content?this.options.content.apply(this.target,[this.fireSequence,this.pageSequence,this.scrollDirection]):this.options.content,this.content!==!1},d.prototype.showContent=function(){return a("#endless_scroll_content_current").removeAttr("id"),this.insertContent('<div id="endless_scroll_content_current" class="endless_scroll_content" data-page="'+this.pageSequence+'">'+this.content+"</div>")},d.prototype.fireCallback=function(){return this.options.callback.apply(this.target,[this.fireSequence,this.pageSequence,this.scrollDirection])},d.prototype.cleanUpPagesWhenNecessary=function(){var a;if(this.options.pagesToKeep>=1){switch(this.scrollDirection){case"next":this.pagesStack.push(this.pageSequence);break;case"prev":this.pagesStack.unshift(this.pageSequence)}if(this.pagesStack.length>this.options.pagesToKeep)switch(this.scrollDirection){case"next":a=this.prevSequence=this.pagesStack.shift();break;case"prev":a=this.nextSequence=this.pagesStack.pop()}return this.removePage(a),this.calculateScrollableCanvas()}},d.prototype.removePage=function(b){return a(".endless_scroll_content[data-page='"+b+"']",this.target).remove()},d.prototype.delayFiringWhenNecessary=function(){return this.options.fireDelay>0?(a("body").after('<div id="endless_scroll_marker"></div>'),a("#endless_scroll_marker").fadeTo(this.options.fireDelay,1,function(b){return function(){return a("#endless_scroll_marker").remove(),b.fired=!1}}(this))):this.fired=!1},d}(),a.fn.endlessScroll=function(a){return new d(this,a).run()},a.fn[f]=function(b){return this.each(function(){return a.data(this,"plugin_"+f)?void 0:a.data(this,"plugin_"+f,new e(this,b))})}}(jQuery,window,document)}).call(this);